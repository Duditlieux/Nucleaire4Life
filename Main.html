<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gretagram</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"/>
    <link rel="stylesheet"href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.8/semantic.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
</head>

<style>
    .container {
        padding-top: 50px;
        width: 720px;
        margin: auto;
    }
</style>

<script>
    $(document).ready(function () {
        $('.ui.accordion').accordion();
    });
</script>

<body ng-app="gretagramApp" ng-controller="gestionPosts">

    <div id="gretacarte" style="height:600px; width:800px">

    </div>

    <div class="ui container">
        <h1 class="ui header">Gretagram</h1>

        <div class="ui styled accordion">
            <div class="title active">
                <h4>
                    <i class="add circle icon"></i>
                    Ajouter un post
                </h4>
            </div>
            <div class="content active">
                <form name="formNewPost" class="ui form" ng-class="postAjout" role="form" ng-submit="nouveauPost()">
                    <div class="fields">
                        <div class="four wide field">
                            <label>Titre</label>
                            <div class="ui icon input">
                                <input name="titre" ng-model="nouveau.titre" type="text" placeholder="Titre du post" required>
                            </div>
                        </div>
                        <div class="twelve wide field">
                            <label>Contenu</label>
                            <input name="contenu" ng-model="nouveau.contenu" type="text" placeholder="Contenu">
                        </div>
                    </div>
                    <div class="ui success message">
						<div class="header">Nouveau post ajouté</div>
						<i class="close icon" ng-click="postAjout=''"></i>
						<p>Le nouveau post a été ajouté avec succès.</p>
					</div>
                    <input class="ui button" type="submit" value="Ajouter">
                </form>
            </div>
        </div>
        <br>
        <div ng-repeat="x in posts">
            <h4 class="ui top attached block header">
                {{ x.titre }}
            </h4>
            <div class="ui bottom attached segment">
                {{ x.contenu }}
            </div>
        </div>

        <script>
            //Section Carte Leaflet
            /*TODO: 
             * Regrouper les marqueurs en clusters.
             * Lier la creation de marqueur avec l'ajout du formulaire.
             * Concerver les marqueurs en tant qu'objets avec attribus.
            */
            var carte = L.map("gretacarte").setView([46.3630104, 2.9846608], 6);
            var newMark;
            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(carte);

            carte.on('click', placeMarker);

            function placeMarker(e)
            {
                newMark = L.marker([e.latlng.lat, e.latlng.lng]);
                newMark.addTo(carte);
                console.log(e.latlng.lat, e.latlng.lng);
            }
            //Fin section

            //Section Angular
            var app = angular.module('gretagramApp', []);
            app.controller('gestionPosts', function ($scope, $http) {

                $scope.posts = [];

                $scope.aujourdHui = function () {
                    return new Date();
                }

                //submit du formulaire
                $scope.nouveauPost = function () {
                    $scope.posts.push($scope.nouveau);
                    $scope.nouveau = {};
                    $scope.postAjout = "success";
                }
                // TODO

            });
            //Fin section

        </script>
    </div>
</body>

</html>